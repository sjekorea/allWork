<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="netfuItemResume">


	<!-- 최근 등록된 이력서 no -->
	<select id="selectRecentlyResumeNo" parameterType="hashmap" resultType="int">
		select
		aa.no
		from 
		(
			select @ROWNUM := @ROWNUM+1 AS ROWNUM, nir.no
			from netfu_item_resume nir, (select @ROWNUM := 0) TMP
			where 1=1
				and uid = #{loginId}
				and inid_secret <![CDATA[<>]]> 'yes'
			order by wdate desc
		) aa
		where aa.ROWNUM = 1
	</select>

	
	<!-- 이력서 갯수 -->
	<select id="selectNetfuItemResumeCnt" parameterType="hashmap" resultType="int">
		select 
			count(nir.no) cnt
		from netfu_item_resume nir
		where 1=1
			and nir.inid_secret <![CDATA[<>]]> 'yes'
			<if test="loginId != null and loginId != ''">
				and nir.uid = #{loginId}
			</if>
			<if test='infoType == "4"'>
				and nir.info_type = #{infoType}
			</if>
			<if test='infoType == "2"'>
				and (nir.info_type = #{infoType} or nir.inid_jobform = 'netfu_34537_33276')
			</if>
			<if test="inidType != null and inidType != ''">
				and (nir.inid_type3 in ('${inidType3}') or nir.inid_type6 in ('${inidType6}') or nir.inid_type9 in ('${inidType7}'))
			</if>
			<if test="inidAreaJob != null and inidAreaJob != ''">
				and (nir.inid_area_job3 in ('${inidAreaJob}') or nir.inid_area_job3 in ('${inidAreaJob}') or nir.inid_area_job3 in ('${inidAreaJob}'))
			</if>
			<if test="inidArea != null and inidArea != ''">
				and (nir.inid_area2 in ('${inidArea}') or nir.inid_area4 in ('${inidArea}') or nir.inid_area6 in ('${inidArea}'))
			</if>
			<if test="inidLicense != null and inidLicense != ''">
				and (nir.inid_license in ('${inidLicense}') or nir.inid_license in ('${inidLicense}') or nir.inid_license in ('${inidLicense}'))
			</if>
			<if test="inidCareer != null and inidCareer != ''">
				and (nir.inid_career in ('${inidCareer}'))
			</if>
			<if test="inidSchool != null and inidSchool != ''">
				and (nir.inid_last_school in ('${inidSchool}'))
			</if>
			<if test="inidJobform != null and inidJobform != ''">
				and (nir.inid_jobform in ('${inidJobform}'))
			</if>
			<if test="inidPay != null and inidPay != ''">
				and (nir.inid_pay in ('${inidPay}'))
			</if>
	</select>
	
	
	<!-- 이력서 리스트 -->
	<select id="selectNetfuItemResumeList" parameterType="hashmap" resultType="allwork.vo.NetfuItemResumeVo">
		select 
			${resumeColumn}
			, nm.sex, nm.birth
		from netfu_item_resume nir left outer join netfu_member nm on nir.uid = nm.uid
		where 1=1
			and nir.inid_secret <![CDATA[<>]]> 'yes'
			<if test="loginId != null and loginId != ''">
				and nir.uid = #{loginId}
			</if>
			<if test='infoType == "4"'>
				and nir.info_type = #{infoType}
			</if>
			<if test='infoType == "2"'>
				and (nir.info_type = #{infoType} or nir.inid_jobform = 'netfu_34537_33276')
			</if>
			<if test="inidType != null and inidType != ''">
				and (nir.inid_type3 in ('${inidType}') or nir.inid_type6 in ('${inidType}') or nir.inid_type9 in ('${inidType}'))
			</if>
			<if test="inidAreaJob != null and inidAreaJob != ''">
				and (nir.inid_area_job3 in ('${inidAreaJob}') or nir.inid_area_job3 in ('${inidAreaJob}') or nir.inid_area_job3 in ('${inidAreaJob}'))
			</if>
			<if test="inidArea != null and inidArea != ''">
				and (nir.inid_area2 in ('${inidArea}') or nir.inid_area4 in ('${inidArea}') or nir.inid_area6 in ('${inidArea}'))
			</if>
			<if test="inidLicense != null and inidLicense != ''">
				and (nir.inid_license in ('${inidLicense}') or nir.inid_license in ('${inidLicense}') or nir.inid_license in ('${inidLicense}'))
			</if>
			<if test="inidCareer != null and inidCareer != ''">
				and (nir.inid_career in ('${inidCareer}'))
			</if>
			<if test="inidSchool != null and inidSchool != ''">
				and (nir.inid_last_school in ('${inidSchool}'))
			</if>
			<if test="inidJobform != null and inidJobform != ''">
				and (nir.inid_jobform in ('${inidJobform}'))
			</if>
			<if test="inidPay != null and inidPay != ''">
				and (nir.inid_pay in ('${inidPay}'))
			</if>
		order by ${orderField} ${orderRule}
		limit #{start}, #{pageSize}
	</select>
	
	
	<!-- keyword 검색 이력서 갯수 -->
	<select id="selectKeywordNetfuItemResumeCnt" parameterType="hashmap" resultType="int">
		select
			count(aa.no) cnt
		from
		(
				select
					resume.no
					, concat(ifnull(resume.name, ''), '|',ifnull(resume.inid_address1, ''), '|',ifnull(resume.inid_address2, ''), '|',ifnull(resume.inid_title, '')
						, '|',ifnull(resume.inid_last_school, ''), '|',ifnull(resume.inid_career, '')
						, '|',ifnull(resume.inid_license, ''), '|',ifnull(resume.inid_languages, '')) fullStr
				from netfu_item_resume resume
				where resume.inid_secret <![CDATA[<>]]> 'yes'
		) aa
		where 1=1
			and (
					aa.fullStr like '%${keyword1}%' 
					<if test="keyword2 != '' and keyword2 != null">
						${keywordCondition} aa.fullStr like '%${keyword2}%'
					</if>
					<if test="keyword3 != '' and keyword3 != null">
						${keywordCondition} aa.fullStr like '%${keyword3}%'
					</if>
				)
	</select>
	
	
	<!-- keyword 검색 이력서 리스트 -->
	<select id="selectKeywordNetfuItemResumeList" parameterType="hashmap" resultType="allwork.vo.NetfuItemResumeVo">
		select 
			${resumeColumn}
			, nm.sex, nm.birth
		from netfu_item_resume nir left outer join netfu_member nm on nir.uid = nm.uid
			, (
				select
					aa.*
				from
				(
						select
							resume.no
							, concat(ifnull(resume.name, ''), '|',ifnull(resume.inid_address1, ''), '|',ifnull(resume.inid_address2, ''), '|',ifnull(resume.inid_title, '')
								, '|',ifnull(resume.inid_last_school, ''), '|',ifnull(resume.inid_career, '')
								, '|',ifnull(resume.inid_license, ''), '|',ifnull(resume.inid_languages, '')) fullStr
						from netfu_item_resume resume
						where resume.inid_secret <![CDATA[<>]]> 'yes'
				) aa
				where 1=1
					and (
							aa.fullStr like '%${keyword1}%' 
							<if test="keyword2 != '' and keyword2 != null">
								${keywordCondition} aa.fullStr like '%${keyword2}%'
							</if>
							<if test="keyword3 != '' and keyword3 != null">
								${keywordCondition} aa.fullStr like '%${keyword3}%'
							</if>
						)
			) keyword
		where 1=1
			and nir.no = keyword.no
		order by ${orderField} ${orderRule}
		limit #{start}, #{pageSize}
	</select>
	
	
	<!-- 이력서 정보 -->
	<select id="selectNetfuItemResumeMap" parameterType="hashmap" resultType="allwork.vo.NetfuItemResumeVo">
		select 
			${resumeColumn}
		from netfu_item_resume nic
		where 1=1
			<choose>
				<when test="personUid != null and personUid != ''">
					and nic.uid = #{personUid}
				</when>
				<otherwise>
					and nic.uid = #{loginId}
				</otherwise>
			</choose>
			<if test="no != null and no != ''">
				and nic.no = #{no}
			</if>
	</select>


</mapper>