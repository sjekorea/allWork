<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="netfuItemCompany">

	
	<!-- 채용정보 검색 Count -->
	<select id="selectNetfuItemCompanyCnt" parameterType="hashmap" resultType="int">
		select count(no) cnt
		from netfu_item_company
		where 1=1
			and biz_ing <![CDATA[<>]]> 'yes'
			and biz_end_day <![CDATA[>=]]> CURRENT_TIMESTAMP()
			<if test="uid != null and uid != ''">
				and uid = #{uid}
			</if>
	</select>
	
	
	<!-- 채용정보 상세 -->
	<!-- 
		- 기업 정보 : select * from netfu_company where uid = '$uid'
		- 모집요강 : select * from netfu_item_company where `no` ='$no'
		     상세요강 : 모집요강 ==> biz_detail
	 -->
	<select id="selectNetfuItemCompanyList" parameterType="hashmap" resultType="allwork.vo.NetfuItemCompanyVo">
		select 
			${recruitColumn}
		from netfu_item_company nic
		where 1=1
			and nic.biz_ing <![CDATA[<>]]> 'yes'
			and nic.biz_end_day <![CDATA[>=]]> CURRENT_TIMESTAMP()
			<if test="uid != null and uid != ''">
				and nic.uid = #{uid}
			</if>
		order by ${orderField} ${orderRule}
		limit #{start}, #{pageSize}
		
	</select>
	
	
	<!-- 기업별 채용공고 Count -->
	<select id="selectNetfuItemCompanyCntByCompany" parameterType="hashmap" resultType="int">
		select count(no) cnt
		from netfu_item_company
		where 1=1
			<if test="companyUid != null and companyUid != ''">
				and uid = #{companyUid}
			</if>
			<choose>
				<when test = "bizIng != null and bizIng != ''">
					and biz_ing = 'no'
		            and ((biz_end_day >= curdate() and biz_end_type ='input') or biz_end_type !='input')
		            and (service1 >= curdate() or service2 >= curdate() or service3 >= curdate() or service4 >= curdate() or service5 >= curdate() or service100 >= curdate())
				</when>
				<otherwise>
					and ((biz_end_day <![CDATA[<]]> curdate() and biz_end_type ='input') or biz_ing='yes' 
				            or (service1 <![CDATA[<]]> curdate() and service2 <![CDATA[<]]> curdate() and service3 <![CDATA[<]]> curdate() 
				            	and service4 <![CDATA[<]]> curdate() and service5 <![CDATA[<]]> curdate() and service100 <![CDATA[<]]> curdate())
				         )
				</otherwise>
			</choose>
	</select>
	
	
	<!-- 기업별 채용공고 목록 -->
	<select id="selectNetfuItemCompanyListByCompany" parameterType="hashmap" resultType="allwork.vo.NetfuItemCompanyVo">
		select 
			nic.no, 'open', nic.biz_name, nic.uid, nic.biz_title, nic.biz_ing, nic.biz_end_type, nic.biz_end_day
			, count(nor.no) total_appliance_cnt
		from netfu_item_company nic, netfu_online_recruit nor
		where 1=1
			<if test="companyUid != null and companyUid != ''">
				and nic.uid = #{companyUid}
			</if>
			<choose>
				<when test="bizIng != null and bizIng != ''">
					and nic.biz_ing = 'no'
		            and ((nic.biz_end_day >= curdate() and nic.biz_end_type ='input') or nic.biz_end_type !='input')
		            and (nic.service1 >= curdate() or nic.service2 >= curdate() or nic.service3 >= curdate() or nic.service4 >= curdate() or nic.service5 >= curdate() or nic.service100 >= curdate())
				</when>
				<otherwise>
					and ((nic.biz_end_day <![CDATA[<]]> curdate() and nic.biz_end_type ='input') or nic.biz_ing='yes' 
				            or (nic.service1 <![CDATA[<]]> curdate() and nic.service2 <![CDATA[<]]> curdate() and nic.service3 <![CDATA[<]]> curdate() 
				            	and nic.service4 <![CDATA[<]]> curdate() and nic.service5 <![CDATA[<]]> curdate() and nic.service100 <![CDATA[<]]> curdate())
				         )
				</otherwise>
			</choose>
		    and nic.uid = nor.to_uid
    		and nic.no = nor.to_no 
		    and nor.to_type in ('email', 'online')
		group by nic.no, nic.uid, nic.biz_title, nic.biz_ing, nic.biz_end_type, nic.biz_end_day
		order by ${orderField} ${orderRule}
		limit #{start}, #{pageSize}
	</select>
	
	
	<!-- 진행중인 채용공고 - selectbox 용 -->
	<select id="selectNetfuItemCompanyProceess" parameterType="hashmap" resultType="allwork.vo.NetfuItemCompanyVo">
		select no, biz_title
		from netfu_item_company
		where 1=1
			and uid = #{companyUid}
			and biz_ing = 'no'
            and ((biz_end_day >= curdate() and biz_end_type ='input') or biz_end_type !='input')
            and (service1 >= curdate() or service2 >= curdate() or service3 >= curdate() or service4 >= curdate() or service5 >= curdate() or service100 >= curdate())
	</select>
	
	
	<!-- 채용정보 상세 -->
	<select id="selectNetfuItemCompanyMap" parameterType="hashmap" resultType="allwork.vo.NetfuItemCompanyVo">
		select 
			${recruitColumn}
		from netfu_item_company nic
		WHERE 1=1
			AND no = #{no}
	</select>
	

	
</mapper>