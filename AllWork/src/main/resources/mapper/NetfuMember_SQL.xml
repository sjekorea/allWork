<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="netfuMember">

	<!-- 회원 정보  -->
	<select id="selectNetfuMemberMap" parameterType="hashmap" resultType="allwork.vo.NetfuMemberVo">
		select 
			*
		from netfu_member
		where 1=1
			<choose>
				<when test="personUid != null and personUid != ''">
					and uid = BINARY(#{personUid})	
				</when>
				<otherwise>
					and uid = BINARY(#{loginId})
				</otherwise>
			</choose>
	</select>
	
	
	<!-- 회원 가입 여부(로그인 처리) -->
	<select id="selectNetfuMemberLoginCnt" parameterType="hashmap" resultType="int">
		select count(uid) cnt from netfu_member
		where 1=1
			and uid = #{loginId}
			and passwd = #{loginPw}
			and type = #{type}
	</select>
	
	
	<!-- ID 중복 확인, ID 찾기, PW 찾기 -->
	<select id="selectUidExistCnt" parameterType="hashmap" resultType="int">
		select count(uid) cnt from netfu_member
		where 1=1
			<if test="uid != null and uid != ''">
				and uid = #{uid}
			</if>
			<if test="name != null and name != ''">
				and name = #{name}
			</if>
			<if test="email != null and email != ''">
				and email = #{email}
			</if>
			<if test="type != null and type != ''">
				and type = #{type}
			</if>
	</select>


	<!-- 회원가입 정보 등록 -->
	<insert id="insertNetfuMember" parameterType="hashmap">
		<![CDATA[
			insert into netfu_member
			(uid, passwd, name, hphone, birth, sex, use_mail, use_sms, email, wdate, login_date, memo, addr_coord, memo_coord
			, type_r2, p_chk, type, hit, a_insert, tosa180422_date, post, address1, address2)
			values
			(
				#{uid}
				, #{passwd}
				, #{name}
				, #{hphone}
				, #{birth}
				, #{sex}
				, #{useMail}
				, #{useSms}
				, #{email}
				, DATE_FORMAT(CURRENT_TIMESTAMP, '%Y-%m-%d %H:%i:%s')
				, DATE_FORMAT(CURRENT_TIMESTAMP, '%Y-%m-%d %H:%i:%s') 
				, #{memo}
				, #{addrCoord}
				, #{memoCoord}
				, #{typeR2}
				, #{pChk}
				, #{type}
				, #{hit}
				, #{aInsert}
				, DATE_FORMAT(CURRENT_TIMESTAMP, '%Y-%m-%d %H:%i:%s') 
				, #{post}
				, #{address1}
				, #{address2}
			)
		]]>
	</insert>
	
	<!--  비밀 번호 변경 -->
	<update id="updatePw" parameterType="hashmap">
		<![CDATA[ 
			update netfu_member
			set passwd = #{passwd}
			where uid = #{uid}
		]]>
	</update>
	
	<!--  회원 탈퇴 처리 -->
	<update id="updateMemberStatus" parameterType="hashmap">
		<![CDATA[ 
			update netfu_member
			set `left` = 'yes'
			where uid = #{uid}
		]]>
	</update>

</mapper>

























