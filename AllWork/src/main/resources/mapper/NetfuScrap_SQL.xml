<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="netfuScrap">
	
	
	<!-- 스크랩한 채용정보 수 -->
	<select id="selectNetfuScrapCnt" parameterType="hashmap" resultType="int">
		select count(uid) cnt from netfu_scrap
		where 1=1
			and type = 'job'
			and sub_type in ('company', 'hdht')
			and uid = #{loginId}
			<choose>
				<when test="no != '' and no != null">
					and no = #{no}
				</when>
				<otherwise>
					and date_add(wdate, interval '3' month) > sysdate()		
				</otherwise>
			</choose>
	</select>
	
	
	<!-- 스크랩한 채용정보 -->
	<select id="selectNetfuScrapList" parameterType="hashmap" resultType="allwork.vo.NetfuItemCompanyVo">
		select 	
			ns.no_to, nic.no, nic.uid, nic.biz_name, nic.biz_title
			, nic.biz_pay, getCodeName(nic.biz_pay) biz_pay_name ### 급여정보
			, nic.biz_career ## 경력
			, nic.biz_age ## 나이
			, nic.biz_area1, getCodeName(nic.biz_area1) biz_area1_name ## 근무지역
			, nic.biz_ability	## 학력
			, nic.biz_sex
			, nic.biz_end_day, nic.biz_end_type, nic.biz_ing
			, nic.biz_type1, getCodeName(nic.biz_type1) biz_type1_name
			, nic.biz_area1, getCodeName(nic.biz_area1) biz_area1_name
			, nic.biz_area2, getCodeName(nic.biz_area2) biz_area2_name
			, nic.biz_jobfrom, getCodeName(nic.biz_jobfrom) biz_jobfrom_name
			, DATE_FORMAT(nic.wdate, '%Y-%m-%d') wdate
		from netfu_scrap ns, netfu_item_company nic
		where 1=1
			and ns.type = 'job'
			and ns.uid = #{loginId}
			and ns.sub_type in ('company', 'hdht')
			and date_add(ns.wdate, interval '3' month) > sysdate()
			and ns.no = nic.no
		order by u_wdate desc 
		LIMIT #{start}, #{pageSize}	
	</select>
	
	<!-- 스크랩한 채용정보 등록 -->
	<insert id="insertNetfuScrap" parameterType="hashmap">
		<![CDATA[
			insert into netfu_scrap
			(uid, type, sub_type, no, r_uid, wdate)
			values
			(
				#{uid}
				, #{type}
				, #{subType}
				, #{no}
				, #{rUid}
				, DATE_FORMAT(CURRENT_TIMESTAMP, '%Y-%m-%d %H:%i:%s')
			)
		]]>
	</insert>
	
	
	<!-- 스크랩한 채용정보 삭제 -->
	<delete id="deleteNetfuScrapMulti" parameterType="hashmap">
		delete from netfu_scrap 
		where 1=1
			and uid = #{loginId}
			and FIND_IN_SET(no_to, #{deleteItemMulti})
	</delete>
	

</mapper>