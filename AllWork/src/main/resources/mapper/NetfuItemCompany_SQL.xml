<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="netfuItemCompany">

	<!-- 채용정보 검색 Count -->
	<select id="selectNetfuItemCompanyCnt" parameterType="hashmap" resultType="int">
		select count(no) cnt
		from netfu_item_company nic
		where 1=1
			and nic.biz_ing <![CDATA[<>]]> 'yes'
			and ((nic.biz_end_type ='input' and nic.biz_end_day <![CDATA[>=]]> CURRENT_TIMESTAMP()) or nic.biz_end_type ='get' or nic.biz_end_type ='often')
			<if test="uid != null and uid != ''">
				and nic.uid = #{uid}
			</if>
			<if test='infoType == "4"'>
				and (nic.biz_jobfrom like '%freelancer%' or nic.biz_jobfrom like '%netfu_34537_33276%')
			</if>
			<if test='infoType == "2"'>
				and (nic.biz_jobfrom like '%arbeit%' or nic.biz_jobfrom like '%netfu_34537_33276%')
			</if>
			<if test="bizType3 != null and bizType3 != ''">
				and (nic.biz_type3 in ('${bizType3}') or nic.biz_type6 in ('${bizType3}') or nic.biz_type9 in ('${bizType3}'))
			</if>
			<if test="areaJob3 != null and areaJob3 != ''">
				and (nic.area_job3 in ('${areaJob3}') or nic.area_job6 in ('${areaJob3}') or nic.area_job9 in ('${areaJob3}'))
			</if>
			<if test="bizArea2 != null and bizArea2 != ''">
				and (nic.biz_area2 in ('${bizArea2}') or nic.biz_area4 in ('${bizArea2}') or nic.biz_area6 in ('${bizArea2}'))
			</if>
	</select>
	
	
	<!-- 채용정보 리스트 -->
	<!-- 
		- 기업 정보 : select * from netfu_company where uid = '$uid'
		- 모집요강 : select * from netfu_item_company where `no` ='$no'
		     상세요강 : 모집요강 ==> biz_detail
	 -->
	<select id="selectNetfuItemCompanyList" parameterType="hashmap" resultType="allwork.vo.NetfuItemCompanyVo">
		select 
			${recruitColumn}
		from netfu_item_company nic
		where 1=1
			and nic.biz_ing <![CDATA[<>]]> 'yes'
			and ((nic.biz_end_type ='input' and nic.biz_end_day <![CDATA[>=]]> CURRENT_TIMESTAMP()) or nic.biz_end_type ='get' or nic.biz_end_type ='often')
			<if test="uid != null and uid != ''">
				and nic.uid = #{uid}
			</if>
			<if test='infoType == "4"'>
				and (nic.biz_jobfrom like '%freelancer%' or nic.biz_jobfrom like '%netfu_34537_33276%')
			</if>
			<if test='infoType == "2"'>
				and (nic.biz_jobfrom like '%arbeit%' or nic.biz_jobfrom like '%netfu_34537_33276%')
			</if>
			<if test="bizType3 != null and bizType3 != ''">
				and (nic.biz_type3 in ('${bizType3}') or nic.biz_type6 in ('${bizType3}') or nic.biz_type9 in ('${bizType3}'))
			</if>
			<if test="areaJob3 != null and areaJob3 != ''">
				and (nic.area_job3 in ('${areaJob3}') or nic.area_job6 in ('${areaJob3}') or nic.area_job9 in ('${areaJob3}'))
			</if>
			<if test="bizArea2 != null and bizArea2 != ''">
				and (nic.biz_area2 in ('${bizArea2}') or nic.biz_area4 in ('${bizArea2}') or nic.biz_area6 in ('${bizArea2}'))
			</if>
		order by ${orderField} ${orderRule}
		limit #{start}, #{pageSize}
	</select>
	
	
	<!-- 키워드 검색 채용정보  Count -->
	<select id="selectKeywordNetfuItemCompanyCnt" parameterType="hashmap" resultType="int">
		select 
			count(aa.no) cnt
		from
		(
			select 
				recruit.no
				, concat(
					ifnull(recruit.biz_name, ''), '|' , ifnull(recruit.biz_title, ''), '|' , ifnull(recruit.biz_address1, ''), '|'
					, ifnull(recruit.biz_business, ''), '|' , ifnull(recruit.biz_detail, ''), '|' , ifnull(recruit.biz_pemail, ''), '|'
				) fullStr
			from netfu_item_company recruit
			where 1=1
				and recruit.biz_ing <![CDATA[<>]]> 'yes'
				and ((recruit.biz_end_type ='input' and recruit.biz_end_day <![CDATA[>=]]> CURRENT_TIMESTAMP()) or recruit.biz_end_type ='get' or recruit.biz_end_type ='often')
		) aa
		where 1=1
			and (
					aa.fullStr like '%${keyword1}%' 
					<if test="keyword2 != '' and keyword2 != null">
						${keywordCondition} aa.fullStr like '%${keyword2}%'
					</if>
					<if test="keyword3 != '' and keyword3 != null">
						${keywordCondition} aa.fullStr like '%${keyword3}%'
					</if>
				)
	</select>
	
	
	<!-- 키워드 검색 채용정보 list -->
	<select id="selectKeywordNetfuItemCompanyList" parameterType="hashmap" resultType="allwork.vo.NetfuItemCompanyVo">
		select 
			${recruitColumn}
		from netfu_item_company nic
			, (
				select 
					aa.*
				from
				(
					select 
						recruit.no
						, concat(
							ifnull(recruit.biz_name, ''), '|' , ifnull(recruit.biz_title, ''), '|' , ifnull(recruit.biz_address1, ''), '|'
							, ifnull(recruit.biz_business, ''), '|' , ifnull(recruit.biz_detail, ''), '|' , ifnull(recruit.biz_pemail, ''), '|'
						) fullStr
					from netfu_item_company recruit
					where 1=1
						and recruit.biz_ing <![CDATA[<>]]> 'yes'
						and ((recruit.biz_end_type ='input' and recruit.biz_end_day <![CDATA[>=]]> CURRENT_TIMESTAMP()) or recruit.biz_end_type ='get' or recruit.biz_end_type ='often')
				) aa
				where 1=1
					and (
							aa.fullStr like '%${keyword1}%' 
							<if test="keyword2 != '' and keyword2 != null">
								${keywordCondition} aa.fullStr like '%${keyword2}%'
							</if>
							<if test="keyword3 != '' and keyword3 != null">
								${keywordCondition} aa.fullStr like '%${keyword3}%'
							</if>
						)
			) keyword
		where 1=1
			and nic.no = keyword.no
		order by ${orderField} ${orderRule}
		limit #{start}, #{pageSize}
	</select>
	
	
	<!-- 기업별 채용공고 Count -->
	<select id="selectNetfuItemCompanyCntByCompany" parameterType="hashmap" resultType="int">
		select count(no) cnt
		from netfu_item_company nic
		where 1=1
			<if test="companyUid != null and companyUid != ''">
				and nic.uid = #{companyUid}
			</if>
			<if test="bizIng == 'no'">
				and nic.biz_ing <![CDATA[<>]]> 'yes'
				and ((nic.biz_end_type ='input' and nic.biz_end_day  >=  CURRENT_TIMESTAMP()) or nic.biz_end_type ='get' or nic.biz_end_type ='often')
			</if>
			<if test="bizIng == 'yes'">
				and nic.biz_ing = 'yes'
				and ((nic.biz_end_day <![CDATA[<]]> curdate() and nic.biz_end_type ='input') or nic.biz_ing='yes' )
			</if>
	</select>
	
	
	<!-- 기업별 채용공고 목록 -->
	<select id="selectNetfuItemCompanyListByCompany" parameterType="hashmap" resultType="allwork.vo.NetfuItemCompanyVo">
		select 
			nic.no, 'open', nic.biz_name, nic.uid, nic.biz_title, nic.biz_ing, nic.biz_end_type, nic.biz_end_day
			, count(nor.no) total_appliance_cnt
		from netfu_item_company nic left outer join netfu_online_recruit nor on nic.uid = nor.to_uid and nic.no = nor.to_no and nor.to_type in ('email', 'online')
		where 1=1
			<if test="companyUid != null and companyUid != ''">
				and nic.uid = #{companyUid}
			</if>
			<if test="bizIng == 'no'">
				and nic.biz_ing <![CDATA[<>]]> 'yes'
				and ((nic.biz_end_type ='input' and nic.biz_end_day  >=  CURRENT_TIMESTAMP()) or nic.biz_end_type ='get' or nic.biz_end_type ='often')
			</if>
			<if test="bizIng == 'yes'">
				and nic.biz_ing = 'yes'
				and ((biz_end_day <![CDATA[<]]> curdate() and biz_end_type ='input') or biz_ing='yes' )
			</if>
		group by nic.no, nic.uid, nic.biz_title, nic.biz_ing, nic.biz_end_type, nic.biz_end_day
		order by ${orderField} ${orderRule}
		limit #{start}, #{pageSize}
	</select>
	
	
	<!-- 진행중인 채용공고 - selectbox 용 -->
	<select id="selectNetfuItemCompanyProceess" parameterType="hashmap" resultType="allwork.vo.NetfuItemCompanyVo">
		select 
			${recruitColumn}
		from netfu_item_company nic
		where 1=1
			and nic.uid = #{companyUid}
			and nic.biz_ing <![CDATA[<>]]> 'yes'
            and ((nic.biz_end_day >= curdate() and nic.biz_end_type ='input') or nic.biz_end_type !='input')
	</select>
	
	
	<!-- 채용정보 상세 -->
	<select id="selectNetfuItemCompanyMap" parameterType="hashmap" resultType="allwork.vo.NetfuItemCompanyVo">
		select 
			${recruitColumn}
		from netfu_item_company nic
		WHERE 1=1
			AND no = #{no}
	</select>
	
	
	<!-- 채용공고 정보 등록 -->
	<insert id="insertNetfuItemCompany" parameterType="hashmap">
		<![CDATA[
			insert into netfu_item_company
			(
				uid, info_type, biz_name, biz_title, biz_post, biz_address1, biz_address2
				, biz_type1, biz_type2, biz_type3, biz_type4, biz_type5, biz_type6
				, biz_position, biz_area1, biz_area2, biz_area3, biz_area4, biz_area5, biz_area6
				, biz_subway, biz_business, biz_men, biz_jobfrom, biz_pay, pay_type, biz_welfare
				, biz_sex, biz_age, biz_ability, biz_preferential, biz_career, biz_detail
				, biz_end_day, biz_end_type, biz_method, biz_person, biz_pemail, biz_pphone, biz_pfax
				, wdate, service1, service2, service3, service4, service5
				, service100, service6, service7, service8, service9, service10, service11
				, biz_paper, biz_form, biz_form_file, biz_type7, biz_type8, biz_type9
				, sms_send, biz_page, hit, type_r, memo
				, biz_area_job1, biz_area_job2, biz_area_job3, biz_area_job4, biz_area_job5, biz_area_job6, biz_area_job7, biz_area_job8, biz_area_job9
			)
			values
			(
				#{uid}, #{infoType}, #{bizName}, #{bizTitle}, #{bizPost}, #{bizAddress1}, #{bizAddress2}
				, #{bizType1}, #{bizType2}, #{bizType3}, #{bizType4}, #{bizType5}, #{bizType6}
				, #{bizPosition}, #{bizArea1}, #{bizArea2}, #{bizArea3}, #{bizArea4}, #{bizArea5}, #{bizArea6}
				, #{bizSubway}, #{bizBusiness}, #{bizMen}, #{bizJobfrom}, #{bizPay}, #{payType}, #{bizWelfare}
				, #{bizSex}, #{bizAge}, #{bizAbility}, #{bizPreferential}, #{bizCareer}, #{bizDetail}
				, #{bizEndDay}, #{bizEndType}, #{bizMethod}, #{bizPerson}, #{bizPemail}, #{bizPphone}, #{bizPfax}
				, DATE_FORMAT(CURRENT_TIMESTAMP, '%Y-%m-%d %H:%i:%s')
				, #{service1}, #{service2}, #{service3}, #{service4}, #{service5}
				, #{service100}, #{service6}, #{service7}, #{service8}, #{service9}, #{service10}, #{service11}
				, #{bizPaper}, #{bizForm}, #{bizFormFile}, #{bizType7}, #{bizType8}, #{bizType9}
				, #{smsSend}, #{bizPage}, 0, #{typeR}, #{memo}
				, #{bizAreaJob1}, #{bizAreaJob2}, #{bizAreaJob3}, #{bizAreaJob4}, #{bizAreaJob5}, #{bizAreaJob6}, #{bizAreaJob7}, #{bizAreaJob8}, #{bizAreaJob9}
			)
		]]>
	</insert>
	

	
</mapper>