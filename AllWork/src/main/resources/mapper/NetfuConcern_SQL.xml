<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="netfuConcern">

	<!-- 관심기업 등록 여부 -->
	<select id="selectNetfuConcernRegistCnt" parameterType="hashmap" resultType="int">
		select count(*) cnt 
		from netfu_concern nc, netfu_item_company nic
		where 1=1
			and nc.uid = #{loginId}
			and nic.no = #{no}
			and r_uid = nic.uid
	</select>

	<!-- 관심기업 수 -->
	<select id="selectNetfuConcernCnt" parameterType="hashmap" resultType="int">
		select count(a.uid) cnt 
		from 
		(
			select
				nco.uid
				, count(nic.no) cnt
				, nco.biz_name
			from netfu_concern nc, netfu_item_company nic, netfu_company nco
			where 1=1
				and nc.uid = #{loginId}
				and nc.type = 'job'
				and nc.sub_type = 'company'
				and nc.r_uid = nco.uid
				and nc.r_uid = nic.uid
				and nic.biz_ing != 'yes'
				and biz_end_day >= CURRENT_TIMESTAMP()
			group by nic.uid, nco.biz_name
		) a
	</select>
	

	<!-- 관심기업 목록 -->
	<select id="selectNetfuConcernList" parameterType="hashmap" resultType="allwork.vo.NetfuConcernVo">
		select
			nco.uid
			, count(nic.no) cnt
			, nco.biz_name
		from netfu_concern nc, netfu_item_company nic, netfu_company nco
		where 1=1
			and nc.uid = #{loginId}
			and nc.type = 'job'
			and nc.sub_type = 'company'
			and nc.r_uid = nco.uid
			and nc.r_uid = nic.uid
			and nic.biz_ing != 'yes'
			and biz_end_day >= CURRENT_TIMESTAMP()
		group by nic.uid, nco.biz_name
	</select>
	

	<!-- 관심기업 채용정보 수 -->
	<select id="selectNetfuConcernRecruntCnt" parameterType="hashmap" resultType="int">
		select count(uid) cnt from netfu_concern
		where 1=1
			and type = 'job'
			and sub_type in ('company')
			and uid = #{loginId}
			and r_uid = #{rUid}
	</select>
	
	
	<!-- 관심기업 채용정보 -->
	<select id="selectNetfuConcernRecruitList" parameterType="hashmap" resultType="allwork.vo.NetfuItemCompanyVo">
		select 	
			ns.no_to, nic.no, nic.uid, nic.biz_name, nic.biz_title
			, nic.biz_pay, getCodeName(nic.biz_pay) biz_pay_name ### 급여정보
			, nic.biz_career ## 경력
			, nic.biz_age ## 나이
			, nic.biz_area1, getCodeName(nic.biz_area1) biz_area1_name ## 근무지역
			, nic.biz_ability	## 학력
			, nic.biz_sex
			, nic.biz_end_day, nic.biz_end_type, nic.biz_ing
			, nic.biz_type1, getCodeName(nic.biz_type1) biz_type1_name
			, nic.biz_area1, getCodeName(nic.biz_area1) biz_area1_name
			, nic.biz_area2, getCodeName(nic.biz_area2) biz_area2_name
			, nic.biz_jobfrom, getCodeName(nic.biz_jobfrom) biz_jobfrom_name
			, DATE_FORMAT(nic.wdate, '%Y-%m-%d') wdate
		from netfu_concern ns, netfu_item_company nic
		where 1=1
			and ns.type = 'job'
			and ns.uid = #{loginId}
			and ns.r_uid = nic.uid
			and ns.sub_type in ('company')
			and date_add(ns.wdate, interval '3' month) > sysdate()
		order by u_wdate desc 
		LIMIT #{start}, #{pageSize}	
	</select>
	
	<!-- 관심기업 채용정보 등록 -->
	<insert id="insertNetfuConcern" parameterType="hashmap">
		<![CDATA[
			insert into netfu_concern
			(uid, type, sub_type, no, r_uid, wdate)
			values
			(
				#{uid}
				, #{type}
				, #{subType}
				, #{no}
				, #{rUid}
				, DATE_FORMAT(CURRENT_TIMESTAMP, '%Y-%m-%d %H:%i:%s')
			)
		]]>
	</insert>
	
	
	<!-- 관심기업 채용정보 삭제 -->
	<delete id="deleteNetfuConcernMulti" parameterType="hashmap">
		delete from netfu_concern 
		where 1=1
			and uid = #{loginId}
			and FIND_IN_SET(r_uid, #{deleteItemMulti})
	</delete>

</mapper>